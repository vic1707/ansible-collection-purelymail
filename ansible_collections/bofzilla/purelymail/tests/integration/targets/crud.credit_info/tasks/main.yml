---
- name: Import integration_config.yml
  ansible.builtin.include_vars:
    # playbook_dir == "<collection_dir>/tests/integration"
    file: "{{ playbook_dir }}/integration_config.yml"

- name: Get account credit
  bofzilla.purelymail.crud.credit_info:
    api_token: "{{ PURELYMAIL_API_TOKEN }}"
  register: result
  environment:
    PURELYMAIL_API_TLS_VERIFY: "{{ PURELYMAIL_API_TLS_VERIFY }}"

- name: Debug result
  ansible.builtin.debug:
    var: result

- name: Assert module returns credit info
  ansible.builtin.assert:
    that:
      - result is not failed
      - result.credit is defined
      - result.credit is number and result.credit is float
      - result.changed == false
