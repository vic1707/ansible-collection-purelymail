---
- name: Import integration_config.yml
  ansible.builtin.include_vars:
    # playbook_dir == "<collection_dir>/tests/integration"
    file: "{{ playbook_dir }}/integration_config.yml"

- name: Get account domains ownership code
  bofzilla.purelymail.crud.domain.get_ownership_code:
    api_token: "{{ PURELYMAIL_API_TOKEN }}"
  register: result
  environment:
    PURELYMAIL_API_TLS_VERIFY: "{{ PURELYMAIL_API_TLS_VERIFY }}"

- name: Debug result
  ansible.builtin.debug:
    var: result

- name: Assert module returns ownership code
  ansible.builtin.assert:
    that:
      - result is not failed
      - result.code is defined
      - result.code is string
      - result.changed == false
