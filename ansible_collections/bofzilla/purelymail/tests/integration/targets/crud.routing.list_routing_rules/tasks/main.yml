---
- name: Import integration_config.yml
  ansible.builtin.include_vars:
    # playbook_dir == "<collection_dir>/tests/integration"
    file: "{{ playbook_dir }}/integration_config.yml"

- name: Get account routing rules
  bofzilla.purelymail.crud.routing.list_routing_rules:
    api_token: "{{ PURELYMAIL_API_TOKEN }}"
  register: result
  environment:
    PURELYMAIL_API_TLS_VERIFY: "{{ PURELYMAIL_API_TLS_VERIFY }}"

- name: Debug result
  ansible.builtin.debug:
    var: result

- name: Assert module returns routing rules
  ansible.builtin.assert:
    that:
      - result is not failed
      - result.changed == false
      - result.rules is defined
      - result.rules | length >= 0
