[env]
_.path = "{{ env.PATH }}:{{ config_root }}/bin"
_.python.venv = { path = "{{ config_root }}/.venv", create = true }
ANSIBLE_HOME = "{{ config_root }}/.ansible"

[tasks.generate-integration-config]
env = { _.file = ".env" }
dir = "{{ config_root }}/ansible_collections/bofzilla/purelymail/tests/integration"
run = '''
rm -f integration_config.yml
while read -r line; do
    eval 'echo "'"$line"'"' >> integration_config.yml
done < integration_config.yml.tpl
'''

[tasks.integration-test]
depends = ["generate-integration-config"]
dir = "{{ config_root }}/ansible_collections/bofzilla/purelymail"
run = "ansible-test integration"

[tasks.unit-test]
dir = "{{ config_root }}/ansible_collections/bofzilla/purelymail"
run = "ansible-test units"

[tasks.tests]
depends = ["unit-test", "integration-test"]

[tools]
actionlint = "1.7.8"
jq = "1.8.1"
python = "3.13.9"
typos = "1.38.1"
uv = "0.9.5"
zizmor = "1.15.2"

[alias]
zizmor = "asdf:vic1707/asdf-zizmor"

[settings.python]
compile = false     ## Forces download of precompiled bin
# uv_venv_auto = true # <https://github.com/jdx/mise-action/issues/295>

[hooks] # <https://github.com/jdx/mise-action/issues/295>
postinstall = "uv sync"

[settings]
experimental = true # needed for uv venv
