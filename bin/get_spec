#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &> /dev/null && pwd)
URI="https://news.purelymail.com/api/swagger-spec.js"
OUT="$SCRIPT_DIR/../spec.jsonc"

get() {
    local url="$1"
    if hash curl; then
        curl -fsSLq "$url"
    elif hash wget; then
        wget -qO- "$url"
    else
        echo "Error: need curl or wget to download $url" >&2
        exit 1
    fi
}

get "$URI" \
    | sed -E 's/^window\.swaggerSpec\s*=\s*//' \
    | sed -E 's/;[[:space:]]*$//' \
    | jq --indent 4 . \
        > "$OUT"
